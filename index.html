<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<h1>My Site</h1>
	

	<h2>Login</h2>
	<form name="login_form">
		<div id="lg_email_err"></div>
		<label>Email:</label>
		<input type="email" name="email"><br>

		<div id="lg_password_err"></div>
		<label>Password:</label>
		<input type="password" name="password">
		<input type="button" id="lg_btn" value="Login">
	</form>

	<h2>Register</h2>

	<form name="reg_form" enctype="multipart/form-data">
		<div id="name_err"></div>
		<label>Name:</label>
		<input type="text" name="name"><br>
		<div id="email_err"></div>
		<label>Email:</label>
		<input type="email" name="email"><br>
		<div id="file_err"></div>
		<label>Profile Picture:</label>
		<input type="file" name="pro_pic"><br>
		<div id="password_err"></div>
		<label>Password:</label>
		<input type="password" name="pswrd"><br>
		<input type="button" id="reg_btn"  value="Register">
	</form>

<div id="temp"></div>

	<script type="text/javascript">

	
		function ValidateLogin(){
			var form = document.forms.login_form;
			var email = form.email.value;
			var password = form.password.value;
			var flag = true;

			if(email == ""){
				document.getElementById("lg_email_err").innerHTML = "Email is required";
				flag = false;
			}else{
				var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;

		        if (reg.test(email) == false) {
		            document.getElementById("lg_email_err").innerHTML = 'Invalid Email Address';
		            flag = false;
		        }
			}
			

	        if(password == ""){
	        	document.getElementById("lg_password_err").innerHTML = "Password required.";
	        	flag = false;
	        }

	        return flag;

		}
		

	    function ValidateFileUpload() {
	        var fuData = document.forms.reg_form.pro_pic;
	        var FileUploadPath = fuData.value;


       		if (FileUploadPath == '') {
	            document.getElementById("file_err").innerHTML = "Please upload an image";

	        } else {
	            var Extension = FileUploadPath.substring(
                FileUploadPath.lastIndexOf('.') + 1).toLowerCase();
                var size = fuData.files[0].size


				if (Extension == "gif" || Extension == "png" || Extension == "bmp"
			                    || Extension == "jpeg" || Extension == "jpg" ) {
					if(size >= 20000 && size <= 2000000 )
						return true;
					else
						document.getElementById("file_err").innerHTML = "Image size must be between 20 KB to 2MB";
				} else {
			        document.getElementById("file_err").innerHTML = "Photo only allows file types of GIF, PNG, JPG, JPEG and BMP. ";

			    }
			}
			return false;
		}

		           
		 function ValidateForm(){
			var form = document.forms.reg_form;
			var name = form.name.value;
			var email = form.email.value;
			var password = form.pswrd.value;
			var flag = true;
			
			if(name == ""){
				document.getElementById("name_err").innerHTML = "Name is required.";
				flag = false;
			}
			if(email == ""){
				document.getElementById("email_err").innerHTML = "Email is required";
				flag = false;
			}else{
				var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;

		        if (reg.test(email) == false) {
		            document.getElementById("email_err").innerHTML = 'Invalid Email Address';
		            flag = false;
		        }
			}
			

	        if(password == ""){
	        	document.getElementById("password_err").innerHTML = "Password required.";
	        	flag = false;
	        }

	        if(!ValidateFileUpload()) flag = false;

	        return flag;
		} 

            

		document.getElementById("reg_btn").addEventListener("click", function(){
	        
	        var xmlhttp = new XMLHttpRequest();

	        xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    document.getElementById("temp").innerHTML =  xmlhttp.responseText;
                }
            }

            var fd = new FormData();


            var form = document.forms.reg_form;

            fd.append("name", form.name.value);
            fd.append("email", form.email.value);
            fd.append("profile_pic", form.pro_pic.files[0]);
            fd.append("password", form.pswrd.value);

            if(ValidateForm()){
            	xmlhttp.open("POST", './api/register.php', true);
            	xmlhttp.send(fd);
            }        

		});


		document.getElementById('lg_btn').addEventListener("click", function(){
			
			var xmlhttp = new XMLHttpRequest();
	        var response="";

	        xmlhttp.onreadystatechange = function() {
			    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			        response =  xmlhttp.responseText;
			       
			    }
			}

			var form = document.forms.login_form;
			var email = form.email.value;
			var password = form.password.value;

			var fd = new FormData();
			fd.append('email', email);
			fd.append('password', password);

			if(true){
            	xmlhttp.open("POST", './api/login.php', true);
            	xmlhttp.send(fd);
            }        

            console.log(response);
		});

	</script>

</body>
</html>